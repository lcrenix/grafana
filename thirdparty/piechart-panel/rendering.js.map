{"version":3,"sources":["../src/rendering.js"],"names":[],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data, panel;\n  elem = elem.find('.piechart-panel');\n\n  var $tooltip = $('<div id=\"tooltip\">');\n\n  ctrl.events.on('render', function() {\n    render();\n    ctrl.renderingCompleted();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n  function addPieChart() {\n    var width = elem.width();\n    var height = elem.height();\n\n    var size = Math.min(width, height);\n\n    var plotCanvas = $('<div></div>');\n    var plotCss = {};\n\n    plotCss.top = '10px';\n    plotCss.margin = 'auto';\n    plotCss.position = 'relative';\n    plotCss.height = (size - 20) + 'px';\n\n    plotCanvas.css(plotCss);\n\n    var $panelContainer = elem.parents('.panel-container');\n    var strokecolor = $panelContainer.css('background-color');\n    var options = {\n      legend: {\n        show: false\n      },\n      series: {\n        pie: {\n          show: true,\n          stroke: {\n            color: strokecolor,\n            width: 0.3\n          },\n          label: {\n            show: ctrl.panel.legend.show && ctrl.panel.legendType === 'On graph'\n          }\n        }\n      },\n      grid: {\n        hoverable: true\n      }\n    };\n\n    if (panel.pieType === 'donut') {\n      options.series.pie.innerRadius = 0.5;\n    }\n\n    elem.html(plotCanvas);\n\n    $.plot(plotCanvas, ctrl.data, options);\n    plotCanvas.bind(\"plothover\", function (event, pos, item) {\n      if (!item) {\n        $tooltip.detach();\n        return;\n      }\n\n      var body;\n      var percent = parseFloat(item.series.percent).toFixed(2);\n      var formatted = ctrl.formatValue(item.series.data[0][1]);\n\n      body = '<div class=\"graph-tooltip-small\"><div class=\"graph-tooltip-time\">';\n      body += '<div class=\"graph-tooltip-value\">' + item.series.label + ': ' + formatted;\n      body += \" (\" + percent + \"%)\" + '</div>';\n      body += \"</div></div>\";\n\n      $tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n    });\n  }\n\n  function render() {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight()) {\n      addPieChart();\n    }\n  }\n}\n\n//export {\n//  panelLink as link\n//};\n"]}